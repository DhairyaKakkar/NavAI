"use strict";(()=>{var t=e=>document.getElementById(e),m=t("goal-section"),v=t("active-section"),L=t("goal"),l=t("start"),d=t("mode"),h=t("goal-display"),H=t("step-num"),g=t("instruction"),a=t("error"),C=t("rescan"),x=t("skip"),B=t("stop"),E=t("llm-section"),s=t("provider"),p=t("endpoint"),M=t("apikey"),f=t("model"),r=t("save-llm"),T=t("history");function i(e){return chrome.runtime.sendMessage(e)}function c(e){e.classList.remove("hidden")}function o(e){e.classList.add("hidden")}function y(e){if(!e.active){c(m),o(v),o(a);return}o(m),c(v),h.textContent=e.goal,H.textContent=`Step ${e.step}`,e.current?(g.textContent=e.current.instruction,o(a)):g.textContent="Scanning page...",T.innerHTML="";for(let n of e.history){let u=document.createElement("li");u.textContent=`${n.action}: "${n.text.substring(0,30)}"`,T.appendChild(u)}}function I(e){a.textContent=e,c(a)}var S={openai:"https://api.openai.com/v1/chat/completions",anthropic:"https://api.anthropic.com/v1/messages",custom:""};d.addEventListener("change",()=>{d.value==="llm"?c(E):o(E)});s.addEventListener("change",()=>{p.value=S[s.value]??""});r.addEventListener("click",async()=>{let e={provider:s.value,endpoint:p.value||S[s.value]||"",apiKey:M.value,model:f.value||"gpt-4o-mini"};await chrome.storage.local.set({navai_llm:e}),r.textContent="Saved!",setTimeout(()=>{r.textContent="Save"},1500)});async function k(){let n=(await chrome.storage.local.get("navai_llm")).navai_llm;n&&(s.value=n.provider,p.value=n.endpoint,M.value=n.apiKey,f.value=n.model)}l.addEventListener("click",async()=>{let e=L.value.trim();if(!e){L.focus();return}let n=d.value;l.disabled=!0,await i({type:"START",goal:e,mode:n}),l.disabled=!1});C.addEventListener("click",()=>i({type:"RESCAN"}));x.addEventListener("click",()=>i({type:"SKIP"}));B.addEventListener("click",()=>i({type:"STOP"}));chrome.runtime.onMessage.addListener(e=>{e.type==="STATE"&&y(e.state),e.type==="ERROR"&&I(e.msg)});(async()=>{await k();let e=await i({type:"GET_STATE"});e?.type==="STATE"&&y(e.state)})();})();
