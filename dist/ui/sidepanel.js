"use strict";(()=>{var t=e=>document.getElementById(e),u=t("goal-section"),L=t("active-section"),E=t("goal-input"),c=t("start-btn"),C=t("goal-display"),v=t("step-label"),g=t("step-instruction"),l=t("step-action"),m=t("error-box"),H=t("rescan-btn"),x=t("skip-btn"),A=t("stop-btn"),I=t("history-count"),T=t("history-list"),f=t("llm-config"),i=t("llm-provider"),d=t("llm-endpoint"),M=t("llm-key"),y=t("llm-model"),r=t("save-llm"),_=document.querySelectorAll('input[name="mode"]');function a(e){return chrome.runtime.sendMessage(e)}function o(e){e.classList.add("hidden")}function s(e){e.classList.remove("hidden")}var S={openai:"https://api.openai.com/v1/chat/completions",anthropic:"https://api.anthropic.com/v1/messages",custom:""};function h(e){if(!e.isActive){s(u),o(L);return}o(u),s(L),C.textContent=`Goal: ${e.goal}`,e.currentStep?(o(m),v.textContent=e.currentStep.stepTitle,g.textContent=e.currentStep.instruction,l.textContent=e.currentStep.action,s(l)):(v.textContent="",g.textContent="Scanning page\u2026",o(l)),I.textContent=String(e.actionHistory.length),T.innerHTML="";for(let n of e.actionHistory){let p=document.createElement("li");p.textContent=`Step ${n.stepNumber}: ${n.action} \u2014 ${new URL(n.url||"about:blank").hostname||"(same page)"}`,T.appendChild(p)}}_.forEach(e=>e.addEventListener("change",()=>{document.querySelector('input[name="mode"]:checked').value==="llm"?s(f):o(f)}));i.addEventListener("change",()=>{let e=i.value;d.value=S[e]??""});r.addEventListener("click",async()=>{let e={provider:i.value,endpoint:d.value.trim()||S[i.value]||"",apiKey:M.value.trim(),model:y.value.trim()};await chrome.storage.local.set({navai_llm_config:e}),r.textContent="Saved!",setTimeout(()=>{r.textContent="Save LLM settings"},1500)});async function b(){let n=(await chrome.storage.local.get("navai_llm_config")).navai_llm_config;n&&(i.value=n.provider,d.value=n.endpoint,M.value=n.apiKey,y.value=n.model)}c.addEventListener("click",async()=>{let e=E.value.trim();if(!e){E.focus();return}let n=document.querySelector('input[name="mode"]:checked').value;c.disabled=!0,await a({type:"START_GUIDANCE",goal:e,mode:n}),c.disabled=!1});H.addEventListener("click",()=>a({type:"RESCAN"}));x.addEventListener("click",()=>a({type:"SKIP_STEP"}));A.addEventListener("click",()=>a({type:"STOP_GUIDANCE"}));chrome.runtime.onMessage.addListener(e=>{e.type==="STATE_UPDATE"&&h(e.state),e.type==="ERROR"&&(m.textContent=e.message,s(m))});(async()=>{await b();let e=await a({type:"GET_STATE"});e?.type==="STATE_UPDATE"&&h(e.state)})();})();
